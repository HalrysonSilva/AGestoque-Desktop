unit FRMSelectproduto;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, Vcl.Grids, Vcl.DBGrids,
  Vcl.StdCtrls, Vcl.ExtCtrls;

type
  TSelectProduto = class(TForm)
    Panel1: TPanel;
    Editselectproduto: TEdit;
    Label1: TLabel;
    DBGridprodutos: TDBGrid;
    Label2: TLabel;
    procedure LimparFormulario;
    procedure EditselectprodutoChange(Sender: TObject);
    procedure DBGridprodutosDblClick(Sender: TObject);
    procedure DBGridprodutosKeyPress(Sender: TObject; var Key: Char);
    procedure EditselectprodutoKeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure FormShow(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  SelectProduto: TSelectProduto;

implementation

{$R *.dfm}

uses CONEXAOBD, FRMAGESTOQUE;


procedure TSelectProduto.LimparFormulario;
begin
  Editselectproduto.Text := ''; // Limpa o campo de pesquisa
  DBGridProdutos.DataSource := nil; // Remove a fonte de dados temporariamente
  DataModule1.QRYSELECIONAPRODUTOS.Close; // Fecha a query
  DataModule1.QRYSELECIONAPRODUTOS.SQL.Text := 'SELECT * FROM tabest1 WHERE 1=0'; // Query vazia
  DataModule1.QRYSELECIONAPRODUTOS.Open; // Reabre a query vazia
end;

procedure TSelectProduto.DBGridprodutosDblClick(Sender: TObject);
begin
  if not DataModule1.qrySelecionaProdutos.IsEmpty then
  begin

    frmmenu.labelproduto.caption := DataModule1.qrySelecionaProdutos.FieldByName('PRODUTO').AsString;

    if Assigned(frmmenu.Editcodinterno) then
      frmmenu.Editcodinterno.Text := DataModule1.qrySelecionaProdutos.FieldByName('CODINTERNO').AsString;

    if Assigned(frmmenu.Editcodbarra) then
      frmmenu.Editcodbarra.Text := DataModule1.qrySelecionaProdutos.FieldByName('CODBARRA').AsString;

    if Assigned(frmmenu.Editcodfornecedor) then
      frmmenu.Editcodfornecedor.Text := DataModule1.qrySelecionaProdutos.FieldByName('CODFORNECEDOR').AsString;

    if Assigned(frmmenu.Editcodorigem) then
      frmmenu.Editcodorigem.Text := DataModule1.qrySelecionaProdutos.FieldByName('CODorigem').AsString;

    if Assigned(frmmenu.Editgrupo) then
      frmmenu.Editgrupo.Text := DataModule1.qrySelecionaProdutos.FieldByName('lksetor').AsString;

    if Assigned(frmmenu.Editmarca) then
      frmmenu.Editmarca.Text := DataModule1.qrySelecionaProdutos.FieldByName('fabricante').AsString;

    if Assigned(frmmenu.Editfornecedor) then
      frmmenu.Editfornecedor.Text := DataModule1.qrySelecionaProdutos.FieldByName('lkfornec').AsString;

    if Assigned(frmmenu.Editlocalizacao) then
      frmmenu.Editlocalizacao.Text := DataModule1.qrySelecionaProdutos.FieldByName('moeda').AsString;


if Assigned(frmmenu.DBTexestoqueloja) then
    frmmenu.DBTexestoqueloja.caption := FormatFloat('0.00', DataModule1.qrySelecionaProdutos.FieldByName('quantidade').AsFloat);

if Assigned(frmmenu.DBTextestoquedeposito) then
    frmmenu.DBTextestoquedeposito.caption := FormatFloat('0.00', DataModule1.qrySelecionaProdutos.FieldByName('qtddepos').AsFloat);

if Assigned(frmmenu.DBTextestoquefiscal) then
    frmmenu.DBTextestoquefiscal.caption := FormatFloat('0.00', DataModule1.qrySelecionaProdutos.FieldByName('qtdfiscal').AsFloat);

if Assigned(frmmenu.DBTextestoqueminino) then
    frmmenu.DBTextestoqueminino.caption := FormatFloat('0.00', DataModule1.qrySelecionaProdutos.FieldByName('estminimo').AsFloat);

frmmenu.DBTextestoquetotal.Caption := FormatFloat('0.00', DataModule1.qrySelecionaProdutos.FieldByName('quantidade').AsFloat + DataModule1.qrySelecionaProdutos.FieldByName('qtddepos').AsFloat);


 // INFORMAÇAO DE PREÇOS

    //preço custo

if Assigned(frmmenu.Editprcusto) then
frmmenu.Editprcusto.Value := DataModule1.qrySelecionaProdutos.FieldByName('PrecoCusto').AsCurrency;

    //Customedio
if Assigned(frmmenu.Editprcustomedio) then
frmmenu.Editprcustomedio.Value := DataModule1.qrySelecionaProdutos.FieldByName('CustoMedio').AsCurrency;


// Margem de Lucro Varejo 1
if Assigned(frmmenu.editmargemvarejo1) then
    frmmenu.editmargemvarejo1.Value := DataModule1.qrySelecionaProdutos.FieldByName('Lucro').AsFloat;

    // Margem de Lucro Varejo 2
if Assigned(frmmenu.editmargemvarejo2) then
    frmmenu.editmargemvarejo2.Value := DataModule1.qrySelecionaProdutos.FieldByName('perprazo').AsFloat;


        // Margem de Lucro Varejo 3
if Assigned(frmmenu.editmargemvarejo3) then
    frmmenu.editmargemvarejo3.Value := DataModule1.qrySelecionaProdutos.FieldByName('peratacado').AsFloat;

           // Margem de Lucro Varejo 4
if Assigned(frmmenu.editmargemvarejo4) then
    frmmenu.editmargemvarejo4.Value := DataModule1.qrySelecionaProdutos.FieldByName('perminimo').AsFloat;


             // PRECO VAREJO 1
if Assigned(frmmenu.editprecovarejo1) then
    frmmenu.editprecovarejo1.Value := DataModule1.qrySelecionaProdutos.FieldByName('precovenda').AsFloat;

                 // PRECO VAREJO 2
if Assigned(frmmenu.editprecovarejo2) then
    frmmenu.editprecovarejo2.Value := DataModule1.qrySelecionaProdutos.FieldByName('prprazo').AsFloat;


                     // PRECO VAREJO 3
if Assigned(frmmenu.editprecovarejo3) then
    frmmenu.editprecovarejo3.Value := DataModule1.qrySelecionaProdutos.FieldByName('pratacado').AsFloat;

                         // PRECO VAREJO 4
if Assigned(frmmenu.editprecovarejo4) then
    frmmenu.editprecovarejo4.Value := DataModule1.qrySelecionaProdutos.FieldByName('prminimo').AsFloat;


                         // Margem de Lucro atacado 1
if Assigned(frmmenu.editmargematacado1) then
    frmmenu.editmargematacado1.Value := DataModule1.qrySelecionaProdutos.FieldByName('peratacado1').AsFloat;

                             // Margem de Lucro atacado 2
if Assigned(frmmenu.editmargematacado2) then
    frmmenu.editmargematacado2.Value := DataModule1.qrySelecionaProdutos.FieldByName('peratacado2').AsFloat;

                             // Margem de Lucro atacado 3
if Assigned(frmmenu.editmargematacado3) then
    frmmenu.editmargematacado3.Value := DataModule1.qrySelecionaProdutos.FieldByName('peratacado3').AsFloat;

                             // Margem de Lucro atacado 4
if Assigned(frmmenu.editmargematacado4) then
    frmmenu.editmargematacado4.Value := DataModule1.qrySelecionaProdutos.FieldByName('peratacado4').AsFloat;

                                 //preço atacado 1
if Assigned(frmmenu.editprecoatacado1) then
    frmmenu.editprecoatacado1.Value := DataModule1.qrySelecionaProdutos.FieldByName('pratacado1').AsFloat;

                                     //preço atacado 2
if Assigned(frmmenu.editprecoatacado2) then
    frmmenu.editprecoatacado2.Value := DataModule1.qrySelecionaProdutos.FieldByName('pratacado2').AsFloat;

                                     //preço atacado 3
if Assigned(frmmenu.editprecoatacado3) then
    frmmenu.editprecoatacado3.Value := DataModule1.qrySelecionaProdutos.FieldByName('pratacado3').AsFloat;

                                     //preço atacado 4
if Assigned(frmmenu.editprecoatacado4) then
    frmmenu.editprecoatacado4.Value := DataModule1.qrySelecionaProdutos.FieldByName('pratacado4').AsFloat;



                                     //preço atacado unitario 1
if Assigned(frmmenu.editprecounatacado1) then
    frmmenu.editprecounatacado1.Value := DataModule1.qrySelecionaProdutos.FieldByName('pratacado1').AsFloat;

                                     //preço atacado unitario 2
if Assigned(frmmenu.editprecounatacado2) then
    frmmenu.editprecounatacado2.Value := DataModule1.qrySelecionaProdutos.FieldByName('pratacado2').AsFloat;

                                     //preço atacado unitario 3
if Assigned(frmmenu.editprecounatacado3) then
    frmmenu.editprecounatacado3.Value := DataModule1.qrySelecionaProdutos.FieldByName('pratacado3').AsFloat;

                                     //preço atacado unitario 4
if Assigned(frmmenu.editprecounatacado4) then
    frmmenu.editprecounatacado4.Value := DataModule1.qrySelecionaProdutos.FieldByName('pratacado4').AsFloat;

                                       //quantidade na embalagem
    if Assigned(frmmenu.editqtdembalagem) then
    frmmenu.editqtdembalagem.text := DataModule1.qrySelecionaProdutos.FieldByName('qtdatacado').Asstring;

                                           //quantidade mimina para atacado
    if Assigned(frmmenu.editqtdminatacado) then
    frmmenu.editqtdminatacado.text := DataModule1.qrySelecionaProdutos.FieldByName('qtdminpratacado').Asstring;










    Close;

  end;
end;

procedure TSelectProduto.DBGridprodutosKeyPress(Sender: TObject; var Key: Char);
begin
  if Key = #13 then // Código para tecla Enter
  begin
    DBGridProdutosDblClick(Sender); // Chama o evento de duplo clique
    Close; // Fecha o formulário de seleção
  end;
end;


procedure TSelectProduto.EditSelectProdutoChange(Sender: TObject);
begin
  with DataModule1.qrySelecionaProdutos do
  begin
    Close;
    SQL.Text := 'SELECT * FROM TABEST1 ' +
                'WHERE CODIGO LIKE ' + QuotedStr('%' + EditSelectProduto.Text + '%') +
                ' OR CODINTERNO LIKE ' + QuotedStr('%' + EditSelectProduto.Text + '%') +
                ' OR CODBARRA LIKE ' + QuotedStr('%' + EditSelectProduto.Text + '%') +
                ' OR CODFORNECEDOR LIKE ' + QuotedStr('%' + EditSelectProduto.Text + '%') +
                ' OR PRODUTO LIKE ' + QuotedStr('%' + EditSelectProduto.Text + '%');
    Open;
  end;

  // Associa a query ao DBGrid
  DBGridProdutos.DataSource := DataModule1.DSQRYSELECIONAPRODUTO;
end;

procedure TSelectProduto.EditselectprodutoKeyDown(Sender: TObject;
  var Key: Word; Shift: TShiftState);
begin
  if Key = VK_DOWN then // Tecla para baixo
  begin
    DBGridProdutos.SetFocus; // Move o foco para o DBGrid
    SendMessage(DBGridProdutos.Handle, WM_KEYDOWN, VK_DOWN, 0); // Simula a tecla para baixo
  end
  else if Key = VK_UP then // Tecla para cima
  begin
    DBGridProdutos.SetFocus; // Move o foco para o DBGrid
    SendMessage(DBGridProdutos.Handle, WM_KEYDOWN, VK_UP, 0); // Simula a tecla para cima
  end;
end;

procedure TSelectProduto.FormShow(Sender: TObject);
begin
EditSelectProduto.SetFocus;
end;

end.
